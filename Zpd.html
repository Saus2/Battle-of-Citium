<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ZpDICæ“ä½œãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f5f5f5; }
    input, textarea, select, button { display: block; margin: 8px 0; padding: 6px; width: 100%; max-width: 500px; }
    textarea { height: 60px; }
    pre { background: #fff; padding: 10px; max-width: 500px; overflow: auto; }
    li { list-style: none; margin: 4px 0; }
  </style>
</head>
<body>
  <h1>ZpDIC APIæ“ä½œãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</h1>

  <label>APIã‚­ãƒ¼:</label>
  <input type="text" id="apiKey">

  <label>è¾æ›¸ID:</label>
  <input type="text" id="dictionaryId" placeholder="ä¾‹: 1197">

  <hr>

  <h2>ğŸ”¹ å˜èªè¿½åŠ </h2>
  <input id="wordName" placeholder="å˜èªå">
  <input id="pronunciation" placeholder="ç™ºéŸ³">
  <input id="wordMeaning" placeholder="æ„å‘³">
  <input id="variations" placeholder="ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ (|åŒºåˆ‡ã‚Š)">
  <input id="tags" placeholder="ã‚¿ã‚° (|åŒºåˆ‡ã‚Š)">
  <button onclick="addWord()">å˜èªã‚’è¿½åŠ </button>

  <hr>

  <h2>ğŸ” å˜èªå–å¾—</h2>
  <input id="wordNumber" placeholder="å˜èªç•ªå·">
  <button onclick="getWord()">å˜èªã‚’å–å¾—</button>
  <pre id="wordResult"></pre>

  <hr>

  <h2>ğŸ’¬ ä¾‹æ–‡è¿½åŠ </h2>
  <textarea id="sentence" placeholder="ä¾‹æ–‡"></textarea>
  <textarea id="translation" placeholder="ç¿»è¨³"></textarea>
  <input id="exampleWordNumber" placeholder="å˜èªç•ªå·ï¼ˆç©ºãªã‚‰ä»Šæ—¥ã®ä¾‹æ–‡ï¼‰">
  <input id="exampleTags" placeholder="ã‚¿ã‚° (|åŒºåˆ‡ã‚Š)">
  <input id="exampleSupplement" placeholder="è£œè¶³">
  <button onclick="addExample()">ä¾‹æ–‡ã‚’è¿½åŠ </button>

  <hr>

  <h2>ğŸ“¥ ä¸€æ‹¬å˜èªè¿½åŠ </h2>
  <textarea id="bulkInput" placeholder="å˜èª, ç™ºéŸ³, ç¿»è¨³, ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³(|åŒºåˆ‡ã‚Š), ã‚¿ã‚°(|åŒºåˆ‡ã‚Š) ã‚’æ”¹è¡ŒåŒºåˆ‡ã‚Šã§"></textarea>
  <button onclick="bulkAddWords()">ä¸€æ‹¬è¿½åŠ </button>

  <hr>

  <h2>ğŸ—‘ ä¸€æ‹¬å˜èªå‰Šé™¤ï¼ˆç¯„å›²æŒ‡å®šå¯¾å¿œãƒ»æœ€å¤§10å€‹ï¼‰</h2>
  <textarea id="deleteWordNumbers" placeholder="ä¾‹: 10-12\n20"></textarea>
  <button onclick="deleteWords()">ä¸€æ‹¬å‰Šé™¤</button>

  <hr>

  <h2>ğŸ“‹ å˜èªTODOãƒªã‚¹ãƒˆï¼ˆsihyou.txtèª­ã¿è¾¼ã¿ãƒ»ãƒã‚§ãƒƒã‚¯ä¿å­˜ï¼‰</h2>
  <button onclick="loadTodo()">TODOã‚’èª­ã¿è¾¼ã¿</button>
  <ul id="todoList"></ul>

  <hr>

  <h2>ğŸ” å˜èªæ¤œç´¢</h2>
  <input id="searchText" placeholder="æ¤œç´¢æ–‡å­—åˆ—">
  <select id="searchMode">
    <option value="both">å˜èªï¼‹è¨³èª (both)</option>
    <option value="name">å˜èªå (name)</option>
    <option value="equivalent">è¨³èª (equivalent)</option>
    <option value="tag">ã‚¿ã‚° (tag)</option>
    <option value="information">å†…å®¹ (information)</option>
    <option value="variation">å¤‰åŒ–å½¢ (variation)</option>
    <option value="relation">é–¢é€£èª (relation)</option>
    <option value="content">å…¨æ–‡ (content)</option>
  </select>
  <button onclick="searchWords()">æ¤œç´¢</button>
  <pre id="searchResult"></pre>

  <script>
    const apiBase = 'https://zpdic.ziphil.com/api/v0';
    const storageKey = 'todoCheckedStatus';

    function getHeaders() {
      return { 'Content-Type': 'application/json', 'X-Api-Key': document.getElementById('apiKey').value };
    }

    async function addWord() {
      const body = {
        word: {
          name: document.getElementById('wordName').value,
          pronunciation: document.getElementById('pronunciation').value,
          equivalents: [],
          tags: document.getElementById('tags').value.split('|').filter(Boolean),
          informations: [{ title: "æ„å‘³", text: document.getElementById('wordMeaning').value }],
          variations: document.getElementById('variations').value.split('|').filter(Boolean).map(v => ({ name: v })),
          relations: []
        }
      };

      const res = await fetch(`${apiBase}/dictionary/${document.getElementById('dictionaryId').value}/word`, {
        method: 'POST', headers: getHeaders(), body: JSON.stringify(body)
      });
      alert(res.ok ? 'âœ… å˜èªè¿½åŠ æˆåŠŸ' : `âŒ ã‚¨ãƒ©ãƒ¼: ${res.status}`);
    }

    async function getWord() {
      const res = await fetch(`${apiBase}/dictionary/${document.getElementById('dictionaryId').value}/word/${document.getElementById('wordNumber').value}`, { headers: getHeaders() });
      document.getElementById('wordResult').textContent = await res.text();
    }

    async function addExample() {
      const wordNumber = document.getElementById('exampleWordNumber').value;
      const body = {
        example: {
          sentence: document.getElementById('sentence').value,
          translation: document.getElementById('translation').value,
          supplement: document.getElementById('exampleSupplement').value,
          tags: document.getElementById('exampleTags').value.split('|').filter(Boolean),
          words: wordNumber ? [{ number: parseInt(wordNumber) }] : [],
          offer: wordNumber ? null : "today"
        }
      };

      const res = await fetch(`${apiBase}/dictionary/${document.getElementById('dictionaryId').value}/example`, {
        method: 'POST', headers: getHeaders(), body: JSON.stringify(body)
      });
      alert(res.ok ? 'âœ… ä¾‹æ–‡è¿½åŠ æˆåŠŸ' : `âŒ ã‚¨ãƒ©ãƒ¼: ${res.status}`);
    }

    async function bulkAddWords() {
      const lines = document.getElementById('bulkInput').value.trim().split('\n');
      for (const line of lines) {
        const [name, pronunciation = "", meaning = "", variations = "", tags = ""] = line.split(',').map(s => s.trim());
        if (!name || !meaning) continue;

        const body = {
          word: {
            name, pronunciation,
            equivalents: [],
            tags: tags.split('|').filter(Boolean),
            informations: [{ title: "æ„å‘³", text: meaning }],
            variations: variations.split('|').filter(Boolean).map(v => ({ name: v })),
            relations: []
          }
        };

        await fetch(`${apiBase}/dictionary/${document.getElementById('dictionaryId').value}/word`, {
          method: 'POST', headers: getHeaders(), body: JSON.stringify(body)
        });
      }
      alert('âœ… ä¸€æ‹¬è¿½åŠ å®Œäº†');
    }

    async function deleteWords() {
      let numbers = [];
      document.getElementById('deleteWordNumbers').value.trim().split('\n').forEach(line => {
        if (line.includes('-')) {
          const [start, end] = line.split('-').map(Number);
          for (let i = start; i <= end; i++) numbers.push(i);
        } else {
          numbers.push(Number(line));
        }
      });

      if (numbers.length === 0 || numbers.length > 10) return alert('âš  å‰Šé™¤æ•°ã¯1ã€œ10å€‹');

      for (const num of numbers) {
        await fetch(`${apiBase}/dictionary/${document.getElementById('dictionaryId').value}/word/${num}`, {
          method: 'DELETE', headers: getHeaders()
        });
      }
      alert('âœ… ä¸€æ‹¬å‰Šé™¤å®Œäº†');
    }

    async function loadTodo() {
      const res = await fetch('sihyou.txt');
      if (!res.ok) return alert('âŒ sihyou.txtèª­ã¿è¾¼ã¿å¤±æ•—');

      const lines = (await res.text()).split('\n').map(line => line.trim()).filter(Boolean);
      const savedStatus = JSON.parse(localStorage.getItem(storageKey) || '{}');
      const list = document.getElementById('todoList');
      list.innerHTML = '';

      lines.forEach(word => {
        const li = document.createElement('li');
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!savedStatus[word];
        const span = document.createElement('span');
        span.textContent = word;
        if (cb.checked) { span.style.textDecoration = 'line-through'; span.style.color = 'gray'; }

        cb.onchange = () => {
          const status = JSON.parse(localStorage.getItem(storageKey) || '{}');
          if (cb.checked) { span.style.textDecoration = 'line-through'; span.style.color = 'gray'; status[word] = true; }
          else { span.style.textDecoration = 'none'; span.style.color = 'black'; delete status[word]; }
          localStorage.setItem(storageKey, JSON.stringify(status));
        };

        li.append(cb, span);
        list.appendChild(li);
      });

      alert('âœ… TODOãƒªã‚¹ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
    }

    async function searchWords() {
      const url = new URL(`${apiBase}/dictionary/${document.getElementById('dictionaryId').value}/word/search`);
      url.searchParams.append('text', document.getElementById('searchText').value);
      url.searchParams.append('mode', document.getElementById('searchMode').value);

      const res = await fetch(url.toString(), { headers: getHeaders() });
      document.getElementById('searchResult').textContent = await res.text();
    }
  </script>
</body>
</html>
