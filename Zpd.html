<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ZpDIC APIæ“ä½œãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    input, textarea, button {
      display: block;
      margin: 8px 0;
      padding: 6px;
      width: 100%;
      max-width: 500px;
    }
    textarea {
      height: 60px;
    }
    pre {
      background: #fff;
      padding: 10px;
      max-width: 500px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1>ZpDIC APIæ“ä½œãƒ„ãƒ¼ãƒ« å®Œå…¨ç‰ˆ</h1>

  <label>APIã‚­ãƒ¼:</label>
  <input type="text" id="apiKey">

  <label>è¾æ›¸ID:</label>
  <input type="text" id="dictionaryId" placeholder="ä¾‹: 1197">

  <hr>

  <h2>ğŸ”¹ å˜èªè¿½åŠ </h2>
  <input id="wordName" placeholder="å˜èªå">
  <input id="pronunciation" placeholder="ç™ºéŸ³ (ä¾‹: foÍo-bÃ¤r)">
  <input id="wordMeaning" placeholder="æ„å‘³ (ä¾‹: æ¶ç©ºã®èª)">
  <input id="variations" placeholder="ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ (ä¾‹: å¤‰ç¨®1|å¤‰ç¨®2)">
  <input id="tags" placeholder="ã‚¿ã‚° (ä¾‹: åŸºæœ¬|é‡è¦)">
  <button onclick="addWord()">å˜èªã‚’è¿½åŠ </button>

  <hr>

  <h2>ğŸ” å˜èªå–å¾—</h2>
  <input id="wordNumber" placeholder="å˜èªç•ªå· (ä¾‹: 123)">
  <button onclick="getWord()">å˜èªã‚’å–å¾—</button>
  <pre id="wordResult"></pre>

  <hr>

  <h2>ğŸ’¬ ä¾‹æ–‡è¿½åŠ </h2>
  <textarea id="sentence" placeholder="ä¾‹æ–‡ (This is foobar.)"></textarea>
  <textarea id="translation" placeholder="ç¿»è¨³ (ã“ã‚Œã¯foobarã§ã™ã€‚)"></textarea>
  <input id="exampleWordNumber" placeholder="é–¢é€£ã™ã‚‹å˜èªç•ªå· (ç©ºãªã‚‰ä»Šæ—¥ã®ä¾‹æ–‡)">
  <input id="exampleTags" placeholder="ã‚¿ã‚° (ä¾‹: æ—¥å¸¸|é‡è¦)">
  <input id="exampleSupplement" placeholder="è£œè¶³ (ä¾‹: åˆç´šå‘ã‘)">
  <button onclick="addExample()">ä¾‹æ–‡ã‚’è¿½åŠ </button>

  <hr>

  <h2>ğŸ“¥ ä¸€æ‹¬å˜èªè¿½åŠ ï¼ˆã‚¿ã‚°ãƒ»ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰</h2>
  <textarea id="bulkInput" placeholder="å˜èª, ç™ºéŸ³, ç¿»è¨³, ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³1|ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³2, ã‚¿ã‚°1|ã‚¿ã‚°2 ã‚’æ”¹è¡ŒåŒºåˆ‡ã‚Šã§å…¥åŠ›"></textarea>
  <button onclick="bulkAddWords()">ä¸€æ‹¬è¿½åŠ </button>

  <hr>

  <h2>ğŸ—‘ å˜èªä¸€æ‹¬å‰Šé™¤ï¼ˆç¯„å›²æŒ‡å®šå¯¾å¿œãƒ»æœ€å¤§10å€‹ï¼‰</h2>
  <textarea id="deleteWordNumbers" placeholder="ä¾‹: 15\n10-12\n20"></textarea>
  <button onclick="deleteWords()">ä¸€æ‹¬å‰Šé™¤</button>

  <script>
    const apiBase = 'https://zpdic.ziphil.com/api/v0';

    function getHeaders() {
      const apiKey = document.getElementById('apiKey').value;
      return {
        'Content-Type': 'application/json',
        'X-Api-Key': apiKey
      };
    }

    async function addWord() {
      const dictionaryId = document.getElementById('dictionaryId').value;
      const name = document.getElementById('wordName').value;
      const pronunciation = document.getElementById('pronunciation').value;
      const meaning = document.getElementById('wordMeaning').value;
      const variations = document.getElementById('variations').value.split('|').map(v => v.trim()).filter(v => v);
      const tags = document.getElementById('tags').value.split('|').map(t => t.trim()).filter(t => t);

      const body = {
        word: {
          name,
          pronunciation,
          equivalents: [],
          tags,
          informations: [{ title: "æ„å‘³", text: meaning }],
          variations: variations.map(v => ({ name: v })),
          relations: []
        }
      };

      const res = await fetch(`${apiBase}/dictionary/${dictionaryId}/word`, {
        method: 'POST',
        headers: getHeaders(),
        body: JSON.stringify(body)
      });

      alert(res.ok ? 'âœ… å˜èªã‚’è¿½åŠ ã—ã¾ã—ãŸ' : `âŒ ã‚¨ãƒ©ãƒ¼: ${res.status}`);
    }

    async function getWord() {
      const dictionaryId = document.getElementById('dictionaryId').value;
      const number = document.getElementById('wordNumber').value;

      const res = await fetch(`${apiBase}/dictionary/${dictionaryId}/word/${number}`, {
        headers: getHeaders()
      });

      const data = await res.json();
      document.getElementById('wordResult').textContent = JSON.stringify(data, null, 2);
    }

    async function addExample() {
      const dictionaryId = document.getElementById('dictionaryId').value;
      const sentence = document.getElementById('sentence').value;
      const translation = document.getElementById('translation').value;
      const wordNumber = document.getElementById('exampleWordNumber').value;
      const tags = document.getElementById('exampleTags').value.split('|').map(t => t.trim()).filter(t => t);
      const supplement = document.getElementById('exampleSupplement').value;

      const body = {
        example: {
          sentence,
          translation,
          supplement,
          tags,
          words: wordNumber ? [{ number: parseInt(wordNumber) }] : [],
          offer: wordNumber ? null : "today"
        }
      };

      const res = await fetch(`${apiBase}/dictionary/${dictionaryId}/example`, {
        method: 'POST',
        headers: getHeaders(),
        body: JSON.stringify(body)
      });

      alert(res.ok ? 'âœ… ä¾‹æ–‡ã‚’è¿½åŠ ã—ã¾ã—ãŸ' : `âŒ ã‚¨ãƒ©ãƒ¼: ${res.status}`);
    }

    async function bulkAddWords() {
      const dictionaryId = document.getElementById('dictionaryId').value;
      const lines = document.getElementById('bulkInput').value.trim().split('\n');

      for (const line of lines) {
        const parts = line.split(',').map(s => s.trim());
        const name = parts[0];
        const pronunciation = parts[1] || "";
        const meaning = parts[2] || "";
        const variations = (parts[3] || "").split('|').map(v => v.trim()).filter(v => v);
        const tags = (parts[4] || "").split('|').map(t => t.trim()).filter(t => t);

        if (!name || !meaning) {
          alert(`âš  ä¸æ­£ãªè¡Œ: ${line}`);
          continue;
        }

        const body = {
          word: {
            name,
            pronunciation,
            equivalents: [],
            tags,
            informations: [{ title: "æ„å‘³", text: meaning }],
            variations: variations.map(v => ({ name: v })),
            relations: []
          }
        };

        const res = await fetch(`${apiBase}/dictionary/${dictionaryId}/word`, {
          method: 'POST',
          headers: getHeaders(),
          body: JSON.stringify(body)
        });

        if (res.ok) {
          console.log(`âœ… ${name} è¿½åŠ æˆåŠŸ`);
        } else {
          console.error(`âŒ ${name} è¿½åŠ å¤±æ•— (${res.status})`);
        }
      }

      alert('ä¸€æ‹¬è¿½åŠ ãŒå®Œäº†ã—ã¾ã—ãŸï¼ˆã‚¨ãƒ©ãƒ¼ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç¢ºèªï¼‰');
    }

    async function deleteWords() {
      const dictionaryId = document.getElementById('dictionaryId').value;
      const lines = document.getElementById('deleteWordNumbers').value.trim().split('\n');
      let numbersToDelete = [];

      for (const line of lines) {
        const trimmed = line.trim();
        if (!trimmed) continue;

        if (trimmed.includes('-')) {
          const [start, end] = trimmed.split('-').map(Number);
          if (isNaN(start) || isNaN(end) || start > end) {
            alert(`âš  ä¸æ­£ãªç¯„å›²æŒ‡å®š: ${line}`);
            return;
          }
          for (let i = start; i <= end; i++) {
            numbersToDelete.push(i);
          }
        } else {
          const num = parseInt(trimmed);
          if (isNaN(num)) {
            alert(`âš  ä¸æ­£ãªå˜èªç•ªå·: ${line}`);
            return;
          }
          numbersToDelete.push(num);
        }
      }

      if (numbersToDelete.length === 0 || numbersToDelete.length > 10) {
        alert('âš  å‰Šé™¤æ•°ã¯1ã€œ10å€‹ã«ã—ã¦ãã ã•ã„ï¼ˆç¯„å›²å±•é–‹å¾Œã®åˆè¨ˆï¼‰');
        return;
      }

      for (const number of numbersToDelete) {
        const res = await fetch(`${apiBase}/dictionary/${dictionaryId}/word/${number}`, {
          method: 'DELETE',
          headers: getHeaders()
        });

        if (res.ok) {
          console.log(`âœ… å˜èªç•ªå· ${number} å‰Šé™¤æˆåŠŸ`);
        } else {
          console.error(`âŒ å˜èªç•ªå· ${number} å‰Šé™¤å¤±æ•— (${res.status})`);
        }
      }

      alert('ä¸€æ‹¬å‰Šé™¤ãŒå®Œäº†ã—ã¾ã—ãŸï¼ˆã‚¨ãƒ©ãƒ¼ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç¢ºèªï¼‰');
    }
  </script>
</body>
</html>
