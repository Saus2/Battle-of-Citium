<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ZpDIC ãƒ•ãƒ«æ©Ÿèƒ½æ“ä½œãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; margin: 20px; background: #f5f5f5; }
    input, textarea, select, button { display: block; margin: 8px 0; padding: 6px; width: 100%; max-width: 500px; }
    textarea { height: 80px; }
    pre { background: #fff; padding: 10px; max-width: 800px; overflow: auto; }
  </style>
</head>
<body>
  <h1>ZpDIC API æ“ä½œç”¨ãƒ„ãƒ¼ãƒ«ï¼ˆå®Œå…¨ç‰ˆï¼‰</h1>
  <label>APIã‚­ãƒ¼ï¼š</label><input type="text" id="apiKey">
  <label>è¾æ›¸IDï¼š</label><input type="text" id="dictionaryId" placeholder="ä¾‹: 1197">

  <hr><h2>ğŸ”¹ å˜èª ä½œæˆ / ç·¨é›† / å‰Šé™¤</h2>
  <input id="editWordNumber" placeholder="å˜èªç•ªå·ï¼ˆæ–°è¦ã¯ç©ºï¼‰">
  <input id="editWordName" placeholder="å˜èªå">
  <input id="editPronunciation" placeholder="ç™ºéŸ³">
  <input id="editVariations" placeholder="å¤‰åŒ–å½¢å|...">
  <input id="editTags" placeholder="ã‚¿ã‚°|...">
  <textarea id="editInformations" placeholder="æ„å‘³ãªã© æƒ…å ±ã‚¿ã‚¤ãƒˆãƒ«|èª¬æ˜ ã®å½¢å¼ã§è¤‡æ•°è¡Œ"></textarea>
  <button onclick="submitWord()">å˜èªã‚’ä¿å­˜ï¼ˆæ–°è¦ or ç·¨é›†ï¼‰</button>
  <button onclick="deleteWord()">å˜èªã‚’å‰Šé™¤</button>
  <button onclick="loadWord()">å˜èªã‚’èª­ã¿è¾¼ã¿ï¼ˆç·¨é›†ç”¨ï¼‰</button>
  <pre id="wordResult"></pre>

  <hr><h2>ğŸ” å˜èªæ¤œç´¢</h2>
  <input id="searchText" placeholder="æ¤œç´¢æ–‡å­—åˆ—">
  <select id="searchMode">
    <option value="both">å˜èªï¼‹è¨³èª</option>
    <option value="name">å˜èªå</option>
    <option value="equivalent">è¨³èª</option>
    <option value="tag">ã‚¿ã‚°</option>
    <option value="information">å†…å®¹</option>
    <option value="variation">å¤‰åŒ–å½¢</option>
    <option value="relation">é–¢é€£èª</option>
    <option value="content">å…¨æ–‡</option>
  </select>
  <button onclick="searchWords()">æ¤œç´¢</button>
  <pre id="searchResult"></pre>

  <hr><h2>ğŸ’¬ ä¾‹æ–‡ ä½œæˆ / ç·¨é›† / å‰Šé™¤</h2>
  <input id="editExampleNumber" placeholder="ä¾‹æ–‡ç•ªå·ï¼ˆæ–°è¦ã¯ç©ºï¼‰">
  <textarea id="editSentence" placeholder="ä¾‹æ–‡"></textarea>
  <textarea id="editTranslation" placeholder="è¨³æ–‡"></textarea>
  <input id="editExampleTags" placeholder="ã‚¿ã‚°|...">
  <input id="editExampleSupplement" placeholder="è£œè¶³">
  <button onclick="submitExample()">ä¾‹æ–‡ã‚’ä¿å­˜ï¼ˆæ–°è¦ or ç·¨é›†ï¼‰</button>
  <button onclick="deleteExample()">ä¾‹æ–‡ã‚’å‰Šé™¤</button>
  <button onclick="loadExample()">ä¾‹æ–‡ã‚’èª­ã¿è¾¼ã¿ï¼ˆç·¨é›†ç”¨ï¼‰</button>
  <pre id="exampleResult"></pre>

  <hr><h2>ğŸ” ä¾‹æ–‡ æ¤œç´¢</h2>
  <input id="searchExampleText" placeholder="æ¤œç´¢æ–‡å­—åˆ—">
  <select id="searchExampleMode">
    <option value="both">æœ¬æ–‡ï¼‹è¨³æ–‡</option>
    <option value="sentence">æœ¬æ–‡</option>
    <option value="translation">è¨³æ–‡</option>
    <option value="tag">ã‚¿ã‚°</option>
    <option value="content">å…¨æ–‡</option>
  </select>
  <button onclick="searchExamples()">æ¤œç´¢</button>
  <pre id="searchExampleResult"></pre>

<script>
  const apiBase = 'https://zpdic.ziphil.com/api/v0';
  function getHeaders() { return {'Content-Type':'application/json','X-Api-Key':document.getElementById('apiKey').value}; }

  // å˜èªé–¢é€£
  async function submitWord(){
    const id=document.getElementById('editWordNumber').value.trim();
    const path=id?
      `/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/word/${encodeURIComponent(id)}`:
      `/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/word`;
    const method=id?'PUT':'POST';
    const infos=document.getElementById('editInformations').value.trim().split('\n').map(l=>{
      const [title,text]=l.split('|');
      return {title:title?.trim(),text:text?.trim()};
    });
    const body={word:{
      name:document.getElementById('editWordName').value.trim(),
      pronunciation:document.getElementById('editPronunciation').value.trim(),
      equivalents:[],
      tags:document.getElementById('editTags').value.split('|').filter(Boolean),
      informations:infos,
      variations:document.getElementById('editVariations').value.split('|').filter(Boolean).map(n=>({name:n})),
      relations:[]
    }};
    const res=await fetch(apiBase+path,{method,headers:getHeaders(),body:JSON.stringify(body)});
    alert(res.ok? 'âœ… å˜èª ' + (id?'æ›´æ–°':'ä½œæˆ') + ' æˆåŠŸ':'âŒ ã‚¨ãƒ©ãƒ¼ ' + res.status);
  }
  async function loadWord(){
    const id=document.getElementById('editWordNumber').value.trim();
    if(!id){return alert('ç•ªå·ã‚’å…¥ã‚Œã¦ãã ã•ã„');}
    const res=await fetch(`${apiBase}/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/word/${id}`,{headers:getHeaders()});
    if(!res.ok)return alert('èª­ã¿è¾¼ã¿å¤±æ•— ' + res.status);
    const data=await res.json();
    const w=data.word;
    document.getElementById('editWordName').value=w.name||'';
    document.getElementById('editPronunciation').value=w.pronunciation||'';
    document.getElementById('editTags').value=(w.tags||[]).join('|');
    document.getElementById('editVariations').value=(w.variations||[]).map(v=>v.name).join('|');
    document.getElementById('editInformations').value=(w.informations||[]).map(i=>i.title+'|'+i.text).join('\n');
    document.getElementById('wordResult').textContent = JSON.stringify(w,null,2);
  }
  async function deleteWord(){
    const id=document.getElementById('editWordNumber').value.trim();
    if(!id)return alert('ç•ªå·ã‚’å…¥ã‚Œã¦ãã ã•ã„');
    const res=await fetch(`${apiBase}/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/word/${id}`,{method:'DELETE',headers:getHeaders()});
    alert(res.ok?'âœ… å‰Šé™¤æˆåŠŸ':'âŒ ã‚¨ãƒ©ãƒ¼ '+res.status);
  }
  async function searchWords(){
    const dict=document.getElementById('dictionaryId').value.trim(),text=document.getElementById('searchText').value.trim();
    if(!dict||!text)return alert('ä¸¡æ–¹å…¥åŠ›å¿…è¦');
    const params=new URLSearchParams({
      text,text,
      mode:document.getElementById('searchMode').value,
      type:'part',ignoreCase:'true',skip:'0',limit:'100',
      orderMode:'unicode',orderDirection:'ascending'
    });
    const res=await fetch(`${apiBase}/dictionary/${encodeURIComponent(dict)}/words?${params}`,{headers:getHeaders()});
    if(!res.ok)return alert('æ¤œç´¢å¤±æ•— '+res.status);
    const js=await res.json();
    document.getElementById('searchResult').textContent=JSON.stringify(js.words||js,null,2);
  }

  // ä¾‹æ–‡é–¢é€£
  async function submitExample(){
    const id=document.getElementById('editExampleNumber').value.trim();
    const path=id?
      `/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/example/${encodeURIComponent(id)}`:
      `/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/example`;
    const method=id?'PUT':'POST';
    const body={example:{
      sentence:document.getElementById('editSentence').value.trim(),
      translation:document.getElementById('editTranslation').value.trim(),
      supplement:document.getElementById('editExampleSupplement').value.trim(),
      tags:document.getElementById('editExampleTags').value.split('|').filter(Boolean),
      words:[], offer:null
    }};
    const res=await fetch(apiBase+path,{method,headers:getHeaders(),body:JSON.stringify(body)});
    alert(res.ok? 'âœ… ä¾‹æ–‡ ' + (id?'æ›´æ–°':'ä½œæˆ') + ' æˆåŠŸ':'âŒ ã‚¨ãƒ©ãƒ¼ ' + res.status);
  }
  async function loadExample(){
    const id=document.getElementById('editExampleNumber').value.trim();
    if(!id)return alert('ç•ªå·ã‚’å…¥ã‚Œã¦ãã ã•ã„');
    const res=await fetch(`${apiBase}/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/example/${id}`,{headers:getHeaders()});
    if(!res.ok)return alert('èª­ã¿è¾¼ã¿å¤±æ•— '+res.status);
    const ex= (await res.json()).example;
    document.getElementById('editSentence').value=ex.sentence||'';
    document.getElementById('editTranslation').value=ex.translation||'';
    document.getElementById('editExampleTags').value=(ex.tags||[]).join('|');
    document.getElementById('editExampleSupplement').value=ex.supplement||'';
    document.getElementById('exampleResult').textContent=JSON.stringify(ex,null,2);
  }
  async function deleteExample(){
    const id=document.getElementById('editExampleNumber').value.trim();
    if(!id)return alert('ç•ªå·ã‚’å…¥ã‚Œã¦ãã ã•ã„');
    const res=await fetch(`${apiBase}/dictionary/${encodeURIComponent(document.getElementById('dictionaryId').value)}/example/${id}`,{method:'DELETE',headers:getHeaders()});
    alert(res.ok?'âœ… å‰Šé™¤æˆåŠŸ':'âŒ ã‚¨ãƒ©ãƒ¼ '+res.status);
  }
  async function searchExamples(){
    const dict=document.getElementById('dictionaryId').value.trim(),text=document.getElementById('searchExampleText').value.trim();
    if(!dict||!text)return alert('ä¸¡æ–¹å…¥åŠ›å¿…è¦');
    const params=new URLSearchParams({
      text,text,
      mode:document.getElementById('searchExampleMode').value,
      type:'part',ignoreCase:'true',skip:'0',limit:'100'
    });
    const res=await fetch(`${apiBase}/dictionary/${encodeURIComponent(dict)}/examples?${params}`,{headers:getHeaders()});
    if(!res.ok)return alert('æ¤œç´¢å¤±æ•— '+res.status);
    const js=await res.json();
    document.getElementById('searchExampleResult').textContent=JSON.stringify(js.examples||js,null,2);
  }
</script>
</body>
</html>
